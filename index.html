<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valida√ß√£o de Certificado - Decole Educacional</title>
  <link rel="icon" type="image/png" href="favicondecole.png" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #000000, #1a1a1a);
      margin: 0;
      padding: 0;
      color: #ffffff;
      text-align: center;
    }

    header {
      background-color: #1a1919dc;
      padding: 40px 20px;
      border-bottom: 3px solid #777c7b;
    }

    header img {
      height: 230px;
      margin-bottom: 15px;
    }

    h1 {
      color: #ffffff;
      font-size: 36px;
      margin: 10px 0;
    }

    p {
      color: #cccccc;
    }

    input[type="text"] {
      padding: 12px;
      width: 90%;
      max-width: 400px;
      margin-top: 20px;
      border-radius: 6px;
      border: 2px solid #726d6d;
      font-size: 16px;
    }

    button {
      margin-top: 15px;
      padding: 10px 14px;
      border: none;
      background-color: #f57a07;
      color: white;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #974b08;
    }

    #resultado-validacao {
      margin: 50px auto;
      max-width: 600px;
    }

    footer {
      background-color: #6470706c;
      color: rgb(197, 2, 2);
      padding: 25px;
      margin-top: 60px;
    }

    footer a {
      color: #dfcdbd;
      margin: 0 12px;
      text-decoration: none;
    }

    @media (max-width: 600px) {
      input[type="text"] {
        width: 95%;
      }
      h1 {
        font-size: 26px;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="decole-logo.png" alt="Logo Decole Educacional">
    <h1>Ambiente de Valida√ß√£o de Certificado</h1>
    <p>Insira sua chave √∫nica do certificado para validar:</p>
    <input type="text" id="input-chave" placeholder="Ex: abc123xyz" onkeypress="if(event.key === 'Enter') validarCertificado()">
    <br>
    <button id="btn-validar" onclick="validarCertificado()">Validar</button>
  </header>

  <div id="resultado-validacao" aria-live="polite"></div>

  <footer>
    <p>¬© 2025 Decole Educacional. Todos os direitos reservados.</p>
    <p>
      <a href="https://decole.co" target="_blank">Site Oficial</a> |
      <a href="https://www.instagram.com/decolecontabildigital/" target="_blank">Instagram</a> |
      <a href="https://wa.me/5508005803080" target="_blank">WhatsApp: 0800 580 3080</a>
    </p>
  </footer>

 <script>
/* ===== AJUSTE AQUI ===== */
const SHEET_ID = '1I7xRjsbckWod963MkHGZXVfPqpF7uKsb'; // <-- substitua pelo ID da SUA planilha
const GID      = '1284708780'; // gid da aba "ALUNOS PAGOS"

/* ===== N√ÉO MEXA ABAIXO ===== */
const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;
let _cacheMapa = null;

const norm = s => (s || '')
  .toString()
  .normalize('NFKC')
  .replace(/\u00A0/g, ' ')   
  .replace(/\s+/g, '')       
  .toUpperCase().trim();

async function carregarMapaChaves() {
  if (_cacheMapa) return _cacheMapa;

  const resp  = await fetch(GVIZ_URL, { cache: 'no-store' });
  const texto = await resp.text();
  const json = JSON.parse(texto.substring(texto.indexOf('{'), texto.lastIndexOf(')')));
  const rows = (json.table && json.table.rows) ? json.table.rows : [];

  let headerIdx = 0;
  for (let i = 0; i < Math.min(6, rows.length); i++) {
    const vals = rows[i].c.map(c => c?.v ? String(c.v).trim().toUpperCase() : '');
    if (vals.includes('CHAVES') || vals.includes('CHAVE')) { headerIdx = i; break; }
  }

  const header = rows[headerIdx].c.map(c => c?.v ? String(c.v).trim().toUpperCase() : '');
  const idxChave = header.findIndex(h => h === 'CHAVES' || h === 'CHAVE');
  const idxNome  = header.findIndex(h => h === 'NOME');
  const idxEmail = header.findIndex(h => h === 'EMAIL');

  if (idxChave === -1) throw new Error('Coluna "CHAVES" n√£o encontrada.');

  const mapa = new Map();
  for (let i = headerIdx + 1; i < rows.length; i++) {
    const c = rows[i].c;
    const chave = norm(c[idxChave]?.v ?? '');
    if (!chave) continue;

    const nome  = (idxNome  >= 0 && c[idxNome]?.v)  ? String(c[idxNome].v).trim()  : '';
    const email = (idxEmail >= 0 && c[idxEmail]?.v) ? String(c[idxEmail].v).trim() : '';
    mapa.set(chave, { nome, email });
  }

  _cacheMapa = mapa;
  return mapa;
}

function mostrar(tipo, html){
  const box = document.getElementById('resultado-validacao');
  box.innerHTML = html;
  box.scrollIntoView({ behavior: 'smooth' });
}

async function validarCertificado() {
  const input = document.getElementById('input-chave');
  const chave = norm(input.value);

  if (!chave) {
    return mostrar('erro', `
      <div style="padding:15px;background:#ffe6e6;border:2px solid #e57373;border-radius:10px;color:#000;">
        <h2 style="color:#c62828;">‚ùå Por favor, insira uma chave v√°lida</h2>
      </div>
    `);
  }

  mostrar('info', `
    <div style="padding:30px;background:#333;border:2px solid #888;border-radius:18px;">
      <h3 style="color:#ddd;">üîé Verificando seu certificado...</h3>
    </div>
  `);

  try {
    const mapa = await carregarMapaChaves();

    if (mapa.has(chave)) {
      const d = mapa.get(chave);
      confetti();
      return mostrar('ok', `
        <div style="padding:30px;background:#2F4F4F;border:2px solid #000;border-radius:16px;color:#fff;">
          <h2 style="color:#FFFAFA;">üéì Certificado encontrado!</h2>
          ${d.nome ? `<p style="font-weight:bold;font-size:18px;">${d.nome}</p>` : ''}
          ${d.email ? `<p>${d.email}</p>` : ''}
          <div style="margin-top:20px;">
            <img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Selo" width="80"/>
          </div>
          <button onclick="baixarCertificado('${chave}')" style="margin-top:25px;padding:12px 20px;font-size:16px;border-radius:30px;background:#f57a07;color:white;border:none;cursor:pointer;">
            üì• Baixar Certificado
          </button>
        </div>
      `);
    }

    return mostrar('erro', `
      <div style="padding:20px;background:#ffe6e6;border:2px solid #e57373;border-radius:12px;color:#000;">
        <h2 style="color:#c62828;">‚ùå Certificado n√£o encontrado</h2>
        <p>Verifique a chave digitada ou entre em contato com o emissor.</p>
      </div>
    `);

  } catch (e) {
    console.error(e);
    return mostrar('erro', `
      <div style="padding:20px;background:#fffde7;border:2px solid #fdd835;border-radius:12px;color:#000;">
        <h2 style="color:#f9a825;">‚ö†Ô∏è Erro ao validar</h2>
        <p>Confirme se a planilha foi <strong>Publicada na Web</strong> e est√° acess√≠vel.</p>
      </div>
    `);
  }
}

function baixarCertificado(chave) {
  const url = `https://raw.githubusercontent.com/Decole1/areadevalidacao/main/certificados/${chave}.pdf`;
  const link = document.createElement('a');
  link.href = url;
  link.download = `${chave}.pdf`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>

</body>
</html>
